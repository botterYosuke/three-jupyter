#!/bin/bash

# Binder postBuild script for three-jupyterlab extension

set -e

echo "=========================================="
echo "Building three-jupyterlab extension"
echo "=========================================="

echo "Step 1: Installing npm dependencies..."
npm install

echo "Step 2: Building the extension..."
npm run build:prod

echo "Step 3: Installing the extension..."
pip install -e .

echo "Step 4: Installing JupyterLab extension..."
jupyter labextension install . --no-build

echo "Step 5: Building JupyterLab (this may take a few minutes)..."
jupyter lab build --minimize=False

echo "Step 6: Verifying extension installation..."
jupyter labextension list

echo "Step 7: Configuring JupyterLab UI (hide sidebars, header, status bar)..."
# JupyterLab設定ディレクトリを作成
mkdir -p ~/.jupyter
mkdir -p ~/.jupyter/lab/user-settings/@jupyterlab/application-extension

# Simple Interfaceを有効にする設定ファイルを作成
cat > ~/.jupyter/lab/user-settings/@jupyterlab/application-extension/settings.jupyterlab-settings << 'EOF'
{
  "simpleMode": true
}
EOF

# jupyter_lab_config.pyを作成して拡張機能を無効化
# 注意: application-extension:topを無効化すると起動に失敗する可能性があるため、
# statusbar-extensionのみを無効化します
cat > ~/.jupyter/jupyter_lab_config.py << 'EOF'
# JupyterLab configuration file
# Disable extensions to hide UI elements

c = get_config()

# Disable Status Bar extension
# Note: Disabling application-extension:top may cause startup failures,
# so we only disable the statusbar extension here
c.LabApp.disabled_extensions = [
    "@jupyterlab/statusbar-extension",  # Hide Status Bar
]
EOF

echo "JupyterLab UI configuration completed successfully!"
echo "- Status Bar: disabled via @jupyterlab/statusbar-extension"
echo "- Simple Interface: enabled"
echo ""
echo "Note: Header and sidebars cannot be safely disabled via extensions"
echo "      as they are core JupyterLab features. Simple Interface mode"
echo "      will minimize their visibility."

echo "=========================================="
echo "Extension installation completed!"
echo "=========================================="
echo ""
echo "The extension is now available in JupyterLab."
echo "Open the command palette (Ctrl+Shift+C) and search for 'Three Jupyter' to use it."

